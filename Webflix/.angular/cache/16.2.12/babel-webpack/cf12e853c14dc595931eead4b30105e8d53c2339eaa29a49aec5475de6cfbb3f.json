{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nlet MovieDetailsComponent = class MovieDetailsComponent {\n  constructor(movieService, route, modalService, userService, router, commentService) {\n    this.movieService = movieService;\n    this.route = route;\n    this.modalService = modalService;\n    this.userService = userService;\n    this.router = router;\n    this.commentService = commentService;\n    this.movieId = this.route.snapshot.params[\"id\"];\n    this.isLoggedIn = false;\n    this.isOwner = false;\n    this.userId = \"\";\n  }\n  ngOnInit() {\n    this.movieService.getMovie(this.movieId).subscribe(movie => {\n      this.movie = movie;\n      this.comments = movie.comments;\n      this.userService.user$.subscribe(user => {\n        if (user) {\n          this.userId = user._id;\n          this.isLoggedIn = true;\n          if (this.movie?.ownerId === user?._id) {\n            this.isOwner = true;\n          }\n        }\n      });\n    });\n  }\n  ngAfterViewInit() {\n    this.commentService.getComments(this.movieId).subscribe(comments => {\n      this.comments = comments;\n    }, error => {\n      console.error('Error fetching comments', error);\n    });\n  }\n  isCommentOwner(comment) {\n    return comment.userId._id === this.userId;\n  }\n  getNewComment(comments) {\n    this.comments = comments;\n  }\n  deleteHandler() {\n    console.log(\"Deleted movie\");\n    this.movieService.deleteMovie(this.movieId).subscribe(() => {\n      this.modalService.open();\n      // Navigate to another page or refresh the current page\n    }, error => {\n      console.error(\"Error deleting movie\", error);\n    });\n  }\n  editHandler() {\n    this.router.navigate([`/movie-edit/${this.movieId}`], {\n      state: {\n        isOwner: this.isOwner\n      }\n    });\n  }\n  deleteComment(comments) {\n    this.commentService.deletesComment(comments._id).subscribe(response => {\n      console.log(\"Comment deleted\", response);\n      this.comments = this.comments.filter(comment => comment._id !== comments._id);\n    }, error => {\n      console.error(\"Error deleting comment\", error);\n    });\n  }\n};\nMovieDetailsComponent = __decorate([Component({\n  selector: \"app-movie-details\",\n  templateUrl: \"./movie-details.component.html\",\n  styleUrls: [\"./movie-details.component.css\"]\n})], MovieDetailsComponent);\nexport default MovieDetailsComponent;","map":{"version":3,"names":["Component","MovieDetailsComponent","constructor","movieService","route","modalService","userService","router","commentService","movieId","snapshot","params","isLoggedIn","isOwner","userId","ngOnInit","getMovie","subscribe","movie","comments","user$","user","_id","ownerId","ngAfterViewInit","getComments","error","console","isCommentOwner","comment","getNewComment","deleteHandler","log","deleteMovie","open","editHandler","navigate","state","deleteComment","deletesComment","response","filter","__decorate","selector","templateUrl","styleUrls"],"sources":["/Users/stoyangalchev/Desktop/Webflix-Angular/Webflix/src/app/feature/movie-details/movie-details.component.ts"],"sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { MovieService } from \"../services/movie.service\";\nimport { Movie } from \"src/app/Types/Movie\";\nimport { ActivatedRoute, Router } from \"@angular/router\";\nimport { ModalService } from \"../services/modal.service\";\nimport { UserService } from \"../services/user.service\";\nimport { CommentService } from \"../services/comment.service\";\n\n@Component({\n  selector: \"app-movie-details\",\n  templateUrl: \"./movie-details.component.html\",\n  styleUrls: [\"./movie-details.component.css\"],\n})\nexport default class MovieDetailsComponent implements OnInit {\n  comments: any;\n  movie: Movie | undefined;\n  movieId = this.route.snapshot.params[\"id\"];\n  isLoggedIn: boolean = false;\n  isOwner: boolean = false;\n  userId: string | undefined = \"\";\n\n  constructor(\n    private movieService: MovieService,\n    private route: ActivatedRoute,\n    private modalService: ModalService,\n    private userService: UserService,\n    private router: Router,\n    private commentService: CommentService\n  ) {}\n\n  ngOnInit(): void {\n    this.movieService.getMovie(this.movieId).subscribe((movie) => {\n      this.movie = movie;\n      this.comments = movie.comments;\n      \n      this.userService.user$.subscribe((user) => {\n        if (user) {\n          this.userId = user._id;\n          this.isLoggedIn = true;\n          if (this.movie?.ownerId === user?._id) {\n            this.isOwner = true;\n          }\n        }\n      });\n    });\n  }\n   ngAfterViewInit() {\n    this.commentService.getComments(this.movieId).subscribe(\n      (comments) => {\n        this.comments = comments;\n      },\n      (error) => {\n        console.error('Error fetching comments', error);\n      }\n    );\n  }\n\n  isCommentOwner(comment: any): boolean | undefined {\n   \n    return comment.userId._id === this.userId;\n  }\n\n  getNewComment(comments: any) {\n  \n    this.comments = comments;\n  }\n\n  deleteHandler(): void {\n    console.log(\"Deleted movie\");\n    this.movieService.deleteMovie(this.movieId).subscribe(\n      () => {\n        this.modalService.open();\n        // Navigate to another page or refresh the current page\n      },\n      (error) => {\n        console.error(\"Error deleting movie\", error);\n      }\n    );\n  }\n\n  editHandler(): void {\n    this.router.navigate([`/movie-edit/${this.movieId}`], {\n      state: { isOwner: this.isOwner },\n    });\n  }\n\n  deleteComment(comments: any): void {\n    this.commentService.deletesComment(comments._id).subscribe(\n      (response) => {\n        console.log(\"Comment deleted\", response);\n\n        this.comments = this.comments.filter(\n          (comment: any) => comment._id !== comments._id\n        );\n      },\n      (error) => {\n        console.error(\"Error deleting comment\", error);\n      }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}